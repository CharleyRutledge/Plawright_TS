# Playwright Agents Guide

Playwright Agents are AI-powered tools that help you build, maintain, and heal your test suite automatically. This project is configured with three agents: **planner**, **generator**, and **healer**.

## Overview

### The Three Agents

1. **ðŸŽ­ Planner** - Explores your app and produces a Markdown test plan
2. **ðŸŽ­ Generator** - Transforms the Markdown plan into executable Playwright tests
3. **ðŸŽ­ Healer** - Executes tests and automatically repairs failing tests

## Prerequisites

- **VS Code v1.105+** (currently on VS Code Insiders channel)
- Node.js v18+
- Playwright installed

## Getting Started

### Agent Configuration

The agents have been pre-configured in this project:

```
.github/chatmodes/          # Agent definitions
â”œâ”€â”€ ðŸŽ­ planner.chatmode.md
â”œâ”€â”€ ðŸŽ­ generator.chatmode.md
â””â”€â”€ ðŸŽ­ healer.chatmode.md

.vscode/mcp.json            # MCP server configuration
tests/seed.spec.ts          # Seed test for agents
specs/                      # Test plans (generated by planner)
```

## Using the Agents

### 1. ðŸŽ­ Planner Agent

The planner explores your application and creates detailed test plans.

**How to use:**

1. Open VS Code chat
2. Select "ðŸŽ­ planner" mode
3. Provide a clear request with context

**Example prompts:**

```
Generate a plan for user login and authentication flows.
```

```
Create a test plan for the checkout process including cart operations.
```

```
Plan tests for the product search and filtering functionality.
```

**Input Requirements:**
- A clear description of what to test
- The `seed.spec.ts` test (automatically included)
- Optional: Product Requirements Document (PRD)

**Output:**
- Markdown file in `specs/` directory (e.g., `specs/login-flow.md`)
- Human-readable test scenarios with steps and expected results

**Example Output Structure:**

```markdown
# Login Flow Test Plan

## Application Overview
Description of the login functionality...

## Test Scenarios

### 1. Successful Login
**Steps:**
1. Navigate to login page
2. Enter valid credentials
3. Click sign in button

**Expected Results:**
- User is redirected to dashboard
- Welcome message is displayed
- User menu shows logged-in state
```

### 2. ðŸŽ­ Generator Agent

The generator transforms test plans into executable Playwright tests.

**How to use:**

1. Ensure you have a test plan in `specs/` (created by planner)
2. Open VS Code chat
3. Select "ðŸŽ­ generator" mode
4. Reference the spec file

**Example prompts:**

```
Generate tests from specs/login-flow.md
```

```
Create Playwright tests based on the spec file for checkout process.
```

**Input Requirements:**
- Markdown test plan from `specs/` directory
- The `seed.spec.ts` file (for reference patterns)

**Output:**
- Executable test files in `tests/` directory
- Tests aligned with the spec scenarios
- Proper assertions and locators

**Generated Test Example:**

```typescript
// spec: specs/login-flow.md
// seed: tests/seed.spec.ts

import { test, expect } from '@playwright/test';

test.describe('Login Flow', () => {
  test('Successful Login', async ({ page }) => {
    // Navigate to login page
    await page.goto('/login');
    
    // Enter valid credentials
    await page.getByLabel('Username').fill('testuser');
    await page.getByLabel('Password').fill('password123');
    
    // Click sign in button
    await page.getByRole('button', { name: 'Sign in' }).click();
    
    // Expected Results
    await expect(page).toHaveURL('/dashboard');
    await expect(page.getByText('Welcome')).toBeVisible();
  });
});
```

### 3. ðŸŽ­ Healer Agent

The healer automatically fixes failing tests by updating locators, waits, or flow adjustments.

**How to use:**

1. Run your test suite and identify failing tests
2. Open VS Code chat
3. Select "ðŸŽ­ healer" mode
4. Mention the failing test

**Example prompts:**

```
Heal the failing test in tests/login.spec.ts
```

```
Fix the login flow test that is failing.
```

**What the healer does:**
- Replays the failing steps
- Inspects the current UI to locate equivalent elements
- Suggests patches (locator updates, wait adjustments)
- Re-runs the test until it passes
- Skips the test if functionality is truly broken

**Common Fixes:**
- Updated selectors when UI changes
- Added proper wait conditions
- Adjusted timeouts
- Fixed assertion expectations

## Workflow Example

### Complete Agent Workflow

Here's how to use all three agents together:

#### Step 1: Plan (Planner)
```
In VS Code Chat, select ðŸŽ­ planner mode:

"Generate a test plan for user registration including email validation, 
password requirements, and successful account creation."
```

**Output:** `specs/user-registration.md`

#### Step 2: Generate (Generator)
```
In VS Code Chat, select ðŸŽ­ generator mode:

"Generate tests from specs/user-registration.md"
```

**Output:** `tests/user-registration.spec.ts`

#### Step 3: Run & Heal (Healer)
```bash
# Run the generated tests
npx playwright test tests/user-registration.spec.ts

# If any fail, in VS Code Chat, select ðŸŽ­ healer mode:
"Heal the failing registration test"
```

**Output:** Fixed test that passes

## Best Practices

### For Planning

1. **Be specific** - Clear requirements produce better test plans
2. **Include context** - Mention any PRDs or requirements documents
3. **Review plans** - Check the generated markdown before generating tests
4. **Update seed test** - Keep seed.spec.ts aligned with your app's patterns

### For Generation

1. **Good specs** - Start with well-structured test plans
2. **Review generated tests** - Check locators and assertions
3. **Customize** - Generated tests are starting points, refine as needed
4. **Use fixtures** - Update generator prompts to use your custom fixtures

### For Healing

1. **Let it run** - Give the healer a few attempts
2. **Check output** - Review what changes the healer made
3. **Learn patterns** - Use healer suggestions to improve your tests
4. **Manual review** - Not all fixes are perfect, review healed tests

## File Organization

```
specs/                          # Test plans (human-readable)
â”œâ”€â”€ example-test-plan.md
â”œâ”€â”€ login-flow.md
â””â”€â”€ checkout-process.md

tests/                          # Generated tests
â”œâ”€â”€ seed.spec.ts               # Foundation test
â”œâ”€â”€ e2e/
â”‚   â”œâ”€â”€ login.spec.ts          # Generated from specs/login-flow.md
â”‚   â””â”€â”€ checkout.spec.ts       # Generated from specs/checkout-process.md
â””â”€â”€ ...
```

## Updating Agents

When you update Playwright, regenerate agent definitions:

```bash
# For VS Code
npx playwright init-agents --loop=vscode

# For Claude Code
npx playwright init-agents --loop=claude

# For OpenCode
npx playwright init-agents --loop=opencode
```

## Tips

1. **Start small** - Begin with simple flows, then expand
2. **Iterate** - Plan â†’ Generate â†’ Run â†’ Heal â†’ Refine
3. **Maintain seed test** - Keep it updated with your app's patterns
4. **Review generated code** - Understand what the agents create
5. **Combine with manual testing** - Agents augment, not replace, manual test writing

## Troubleshooting

### Agents not available in VS Code

**Solution:**
- Ensure VS Code v1.105+ is installed
- Check that `.github/chatmodes/` contains agent files
- Verify `.vscode/mcp.json` exists
- Restart VS Code

### Generated tests failing

**Solution:**
- Run the healer agent first
- Check if seed test passes
- Verify base URL and environment setup
- Update test plan if requirements changed

### Planner not exploring correctly

**Solution:**
- Ensure seed.spec.ts runs successfully
- Check that baseURL is correct in config
- Verify application is accessible
- Provide more context in your planning prompt

## Resources

- [Playwright Agents Documentation](https://playwright.dev/docs/test-agents)
- [MCP Server Documentation](https://modelcontextprotocol.io/)
- [VS Code Chat Modes](https://code.visualstudio.com/)

## Example Sessions

### Planning a Shopping Cart

```
ðŸŽ­ Planner Prompt:
"Plan comprehensive tests for an e-commerce shopping cart including:
- Adding items to cart
- Updating quantities
- Removing items
- Cart persistence
- Checkout initiation"

Output: specs/shopping-cart.md
```

### Generating Tests

```
ðŸŽ­ Generator Prompt:
"Generate tests from specs/shopping-cart.md using our custom fixtures"

Output: tests/e2e/shopping-cart.spec.ts
```

### Healing Failed Tests

```
After running tests and seeing failures:

ðŸŽ­ Healer Prompt:
"Heal the failing test 'add item to cart' in tests/e2e/shopping-cart.spec.ts"

Output: Updated test with fixed locators/waits
```

